server:
  port: 8080

spring:
  application:
    name: gateway

  cloud:
    gateway:
      default-filters:
        - RemoveRequestHeader=Cookie
      # ... (CORS Configuration) ...
      server:
        webflux:
          globalcors:
            cors-configurations:
              '[/**]':
                allowedOrigins: 'http://localhost:5173, http://localhost:3000'
                allowedMethods: '*'
                allowedHeaders: '*'
                allowCredentials: true

      # üõ£Ô∏è RUTA DE PRUEBA:
      routes:
        - id: solicitudes-service
          uri: lb://solicitudes
          predicates:
            - Path=/api/solicitudes/**

  security:
    oauth2:
      client:
        registration:
          keycloak:
            provider: keycloak
            client-id: tpi-backend-client
            authorization-grant-type: authorization_code
            # Esta URL de redirecci√≥n es la que usa el navegador, se mantiene en localhost
            redirect-uri: http://localhost:8080/login/oauth2/code/keycloak
            scope: openid, profile, email

        provider:
          keycloak:
            # üí° FIX CR√çTICO: Debe coincidir con KC_HOSTNAME_URL para que Spring inicie.
            issuer-uri: http://host.docker.internal:8180/realms/tpi-backend

      resourceserver:
        jwt:
          # üí° FIX CR√çTICO: Debe coincidir con KC_HOSTNAME_URL para que Spring inicie.
          issuer-uri: http://host.docker.internal:8180/realms/tpi-backend

logging:
  level:
    org.springframework.cloud.gateway: INFO
    org.springframework.security: INFO
